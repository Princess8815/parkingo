<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Theme Park Bingo – Game</title>
    <link rel="stylesheet" href="/parkingo/styles/game.css" />
  </head>
  <body>
    <div class="game-container">
      <h1>🎢 Theme Park Bingo Game 🎠</h1>

      <!-- Game mode selection -->
      <div id="gameModeSelection" class="game-mode-selection">
        <h2>Choose Game Mode</h2>
        <button class="mode-button" onclick="startSoloGame()">Play Solo</button>
        <button class="mode-button" onclick="showMultiplayerOptions()">Multiplayer</button>
      </div>

      <!-- Multiplayer options -->
      <div id="multiplayerOptions" class="multiplayer-options" style="display: none">
        <h3>Multiplayer Options</h3>
        <button class="room-button" onclick="createMultiplayerGame()">Create Game Room</button>
        <div class="join-game-section">
          <input type="text" id="joinGameCode" placeholder="Enter Game Code" maxlength="6" />
          <button class="room-button" onclick="joinMultiplayerGame()">Join Game</button>
        </div>
        <button class="back-button" onclick="showGameModeSelection()">← Back</button>
      </div>

      <!-- Game status display -->
      <div id="gameStatus" class="game-status" style="display: none">
        <span id="connectionStatus">Solo Mode</span>
        <span id="gameCode" style="display: none"></span>
        <span id="playerCount" style="display: none"></span>
      </div>

      <!-- Bingo Card Section -->
      <div class="bingo-card-container" id="bingoCardContainer" style="display: none">
        <div class="bingo-header">
          <div class="header-cell"></div>
          <div class="header-cell">B</div>
          <div class="header-cell">I</div>
          <div class="header-cell">N</div>
          <div class="header-cell">G</div>
          <div class="header-cell">O</div>
        </div>
        <div class="bingo-grid" id="bingoGrid"></div>

        <div class="card-buttons">
          <button class="card-button perks" onclick="showPerks()">View Perks</button>
          <button class="card-button challenges" onclick="showChallenges()">View Challenges</button>
          <button class="card-button punishments" onclick="showPunishments()">View Punishments</button>
          <button class="card-button hand" onclick="showHand()">Current Hand</button>
          <button class="new-card-button" onclick="generateNewCard()">New Card</button>
          <button class="end-game-button" onclick="endGame()">End Game</button>
        </div>

        <!-- Deck Management Section -->
        <div class="deck-management">
          <div class="current-challenge" id="currentChallenge">
            <strong>Current Challenge:</strong>
            <span id="challengeText">None</span>
          </div>

          <div class="deck-buttons">
            <button class="deck-button" id="drawChallengeBtn" onclick="drawChallengeCard()">Draw Challenge Card</button>
            <button class="deck-button" id="drawPerkBtn" onclick="drawPerkCard()" disabled>Draw Perk Card</button>
            <button class="deck-button" id="completeChallengeBtn" onclick="completeChallenge()" disabled>Complete Challenge</button>
            <button class="deck-button" id="markRideBtn" onclick="markRideCompleted()">Mark Ride (or tap squares)</button>
          </div>

          <div class="challenge-display" id="challengeDisplay"></div>
          <div class="perk-display" id="perkDisplay"></div>

          <div class="card-counter">
            Challenge Cards Left: <span id="challengeCount">0</span> |
            Perk Cards Left: <span id="perkCount">0</span>
          </div>
        </div>
      </div>

      <!-- Bingo Alert -->
      <div class="bingo-alert" id="bingoAlert">
        <h2>🎉 BINGO! 🎉</h2>
        <p>Congratulations! You've achieved bingo!</p>
        <button onclick="closeBingoAlert()">Continue Playing</button>
      </div>
    </div>

    <button id="rulesButton" class="rules-button">Rules</button>

    <!-- Rules Modal -->
    <div id="rulesModal" class="modal">
      <div class="modal-content">
        <span class="close-button">&times;</span>
        <h2>🎮 Six Flags Secret Quest – Official Rules (Final)</h2>
        <p>
          🔢 <strong>Setup</strong><br />
          Each player has a secret bingo card containing:<br />
          • 5 roller coasters<br />
          • 10 flat or water rides<br />
          • 10 specific challenge squares<br />
          No one sees their own card. Each player tracks another player's card.
        </p>
        <p>
          ▶️ <strong>How to Play</strong><br />
          1. Group picks a ride. Riders draw cards and mark their cards if it appears.<br />
          2. After each ride:<br />
          • Draw a Challenge Card (must complete before next ride)<br />
          • Coaster riders also draw a Perk Card<br />
          3. Match your challenge card name to your card to mark a space<br />
          4. Punishment cards must be done immediately<br />
        </p>
        <p>
          🎯 <strong>Winning</strong><br />
          Your tracker announces your bingo. First to bingo wins!
        </p>
      </div>
    </div>

    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>

    <!-- App Scripts -->
    <script src="/parkingo/script/firebase-config.js"></script>
    <script src="/parkingo/script/database.js"></script>
    <script src="/parkingo/script/6-flags.js"></script>

    <!-- Rules Modal Logic -->
    <script>
      const rulesModal = document.getElementById('rulesModal')
      const rulesButton = document.getElementById('rulesButton')
      const closeButton = document.querySelector('.close-button')

      rulesButton.onclick = () => (rulesModal.style.display = 'block')
      closeButton.onclick = () => (rulesModal.style.display = 'none')
      window.onclick = (e) => {
        if (e.target === rulesModal) rulesModal.style.display = 'none'
      }
    </script>
  </body>
</html>

